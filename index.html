<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PlanCraft ¬∑ Sleek PM Planning</title>
  <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/appanda93/PlanCraft/main/AppIcon%20180x180.png?v=3">
  <link rel="icon" type="image/png" sizes="180x180" href="https://raw.githubusercontent.com/appanda93/PlanCraft/main/AppIcon%20180x180.png?v=3">
  <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/appanda93/PlanCraft/main/AppIcon%20180x180.png?v=3">
  <meta name="theme-color" content="#d9a6c1">
  <style>
    body { background:#0e1116; color:#e9f0f6; font-family:Inter, sans-serif; margin:0; }
    .app{display:grid; grid-template-columns:260px 1fr; grid-template-rows:64px minmax(0,1fr);
         grid-template-areas:"aside header" "aside main"; height:100%}
    header{grid-area:header; display:flex; align-items:center; gap:16px; padding:0 20px;}
    aside{grid-area:aside; padding:18px;}
    main{grid-area:main; padding:22px; overflow:auto}
    .brand{display:flex; align-items:center; gap:12px; font-weight:700;}
    .card{background:#141925; border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:16px; margin-bottom:16px;}
    .section{display:flex; flex-direction:column; gap:14px}
    table{width:100%; border-collapse:separate; border-spacing:0 8px}
    th{color:#8aa0b4; font-weight:600; text-align:left; font-size:12px}
    td{background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08); padding:10px; border-radius:8px}
    .muted{color:#8aa0b4}
  </style>
</head>
<body>
  <div class="app">
    <aside>
      <div class="brand">
        <div>PlanCraft</div>
      </div>
      <nav id="nav">
        <div class="nav-item active" data-view="dashboard">üè† Dashboard</div>
        <div class="nav-item" data-view="plan">üóÇÔ∏è Project Plan</div>
        <div class="nav-item" data-view="raid">üõ°Ô∏è Risks/ Issues</div>
      </nav>
    </aside>

    <header>
      <div class="brand">PlanCraft</div>
    </header>

    <main>
      <!-- DASHBOARD -->
      <section id="view-dashboard" class="section">
        <div class="grid" id="projectGrid"></div>
        <div class="grid">
          <div class="card">
            <h3>Portfolio KPIs</h3>
            <div class="bubble">On-time milestones: <b id="kpiMilestones">‚Äî</b></div>
          </div>
          <!-- To-Do Notepad -->
          <div class="card">
            <h3>To-Do Notepad</h3>
            <div class="muted">Today: <b id="todoToday">‚Äî</b></div>
            <div class="row" style="margin-top:8px">
              <div class="col"><input id="todoInput" placeholder="e.g., Schedule review"/></div>
              <div class="col"><label>For Date<input type="date" id="todoDate"/></label></div>
              <button class="btn" id="todoAdd">Ôºã Add</button>
            </div>
            <div class="row" style="margin-top:8px; align-items:flex-end; flex-wrap:wrap">
              <div class="col"><label>View Date<input type="date" id="todoFilterDate"/></label></div>
              <label class="muted"><input type="checkbox" id="todoShowAll"/> Show all</label>
              <div class="spacer"></div>
              <div id="todoFilterHint" class="muted"></div>
            </div>
            <ul id="todoList" class="todo-list"></ul>
          </div>
        </div>
      </section>

      <!-- PLAN -->
      <section id="view-plan" class="section hidden">
        <div class="card">
          <h3>Work Breakdown</h3>
          <table>
            <thead><tr><th>Task</th><th>Assignee</th><th>Start</th><th>End</th></tr></thead>
            <tbody id="taskTable"></tbody>
          </table>
        </div>
      </section>

      <!-- RAID -->
      <section id="view-raid" class="section hidden">
        <div class="card">
          <div>RAID for <h3 id="raidProjectName">‚Äî</h3></div>
        </div>
        <div class="card">
          <h3>Risks</h3>
          <table><thead><tr><th>Title</th><th>P</th><th>I</th><th>Exposure</th><th>Owner</th><th>Status</th></tr></thead>
            <tbody id="riskTable"></tbody></table>
        </div>
        <div class="card">
          <h3>Issues</h3>
          <table><thead><tr><th>Title</th><th>Severity</th><th>Owner</th><th>ETA</th><th>Status</th></tr></thead>
            <tbody id="issueTable"></tbody></table>
        </div>
      </section>
    </main>
  </div>

  <script>
  const state = JSON.parse(localStorage.getItem('plancraft')||'{}');
  state.projects ||= [];
  let currentProjectId = state.projects[0]?.id || null;
  const qs=(s,e=document)=>e.querySelector(s);
  const esc=s=>(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  const fmt=d=>d?new Date(d).toISOString().slice(0,10):'';

  // RAID view function
  function renderRAID(){
    const p = state.projects.find(x=>x.id===currentProjectId) || state.projects[0] || null;
    const nameEl = qs('#raidProjectName');
    if(nameEl) nameEl.textContent = p?.name || '‚Äî';

    // Risks
    const rT=qs('#riskTable'); rT.innerHTML='';
    const risks=p?.risks||[];
    if(risks.length===0){
      rT.innerHTML='<tr><td colspan="6" class="muted">No risks yet.</td></tr>';
    } else {
      risks.forEach(r=>{
        rT.innerHTML+=`<tr><td contenteditable>${esc(r.title||'')}</td>
          <td>${r.p||2}</td><td>${r.i||2}</td>
          <td>${(r.p||2)*(r.i||2)}</td>
          <td>${esc(r.owner||'')}</td>
          <td>${esc(r.status||'')}</td></tr>`;
      });
    }

    // Issues
    const iT=qs('#issueTable'); iT.innerHTML='';
    const issues=p?.issues||[];
    if(issues.length===0){
      iT.innerHTML='<tr><td colspan="5" class="muted">No issues yet.</td></tr>';
    } else {
      issues.forEach(it=>{
        iT.innerHTML+=`<tr><td contenteditable>${esc(it.title||'')}</td>
          <td>${esc(it.sev||'')}</td>
          <td>${esc(it.owner||'')}</td>
          <td>${fmt(it.eta||new Date())}</td>
          <td>${esc(it.status||'')}</td></tr>`;
      });
    }
  }

  function showView(id){
    document.querySelectorAll('main > section').forEach(s=>s.classList.toggle('hidden',s.id!=='view-'+id));
    if(id==='raid') renderRAID();
  }
  document.querySelectorAll('[data-view]').forEach(n=>n.addEventListener('click',()=>showView(n.dataset.view)));

  // Init
  showView('dashboard');
  </script>
</body>
</html>
